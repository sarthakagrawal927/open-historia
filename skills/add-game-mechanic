#!/bin/bash
# Skill: Add Game Mechanic using both Gemini (design) and Codex (implementation)
# Usage: ./skills/add-game-mechanic "mechanic description"

MECHANIC="$1"

if [ -z "$MECHANIC" ]; then
    echo "Usage: $0 'mechanic description'"
    exit 1
fi

echo "üéÆ Phase 1: Using Codex to design game mechanic: $MECHANIC"

DESIGN_PROMPT="You are a game designer for Open Historia, a grand strategy game.

TASK: Design Game Mechanic - $MECHANIC

Provide:
1. Mechanic overview and goals
2. Required data structures (TypeScript interfaces)
3. Game state changes needed
4. User interactions required
5. AI prompt updates needed
6. Implementation steps

Be specific and consider balance, complexity, and fun."

DESIGN=$(curl -s https://api.openai.com/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer ${OPENAI_API_KEY}" \
  -d "{
    \"model\": \"gpt-4\",
    \"messages\": [{\"role\": \"user\", \"content\": $(echo "$DESIGN_PROMPT" | jq -Rs .)}],
    \"max_tokens\": 1500
  }" | jq -r '.choices[0].message.content')

echo "üìê Design Phase Complete:"
echo "$DESIGN"
echo ""
echo "üõ†Ô∏è  Phase 2: Using Gemini to implement..."

gemini --prompt "You are implementing a game mechanic for Open Historia.

DESIGN SPECIFICATION:
$DESIGN

TASK: Implement this mechanic step-by-step
1. Update lib/types.ts with new types
2. Modify game state management in app/page.tsx
3. Update UI components as needed
4. Update AI prompts in app/api/turn/route.ts
5. Test the mechanic works
6. Commit incrementally

Start implementation now." --yolo
